# Internship at Lucis [2020.07.01 ~ 2020.12.21]

### 실습담당업무 소개
  - T-안심지킴이 서버 운영관리 부서에서 실습을 진행하였다. 
  - T-안심지킴이 서비스란, 유치원생 또는 초등학생의 자녀가 등하원(또는 등하교)를 했을때 자녀의 부모님에게 문자 또는 푸시 메세지가 전송되어 자녀의 등교, 하교의 현황을 알 수 있게 해주는 서비스이다.

### 실습 내용
  - 배치파일 만들기 : 상시 실행중인 상태로 유지해야 하는 서버 프로그램이 가끔씩 과부하로 인해 꺼지는 경우가 발생한다고 하여 매일 특정 시간에 프로그램을 종료하고 다시 실행하는 배치파일을 만들었고,  서버 프로그램이 실행되면서 만들어지는 로그(기록)파일을 특정 폴더로 옮겨지는 배치파일도 만들었다.   
  
  - 프로시저 작성 : SQL과 프로시저에 대한 공부를 하여 현재 운영중인 서비스의 또 다른 백업DB에 접속하여 DB 안에 있는 테이블의 속성과 속성값을 SQL문을 이용하여 조회하면서 데이터 분석을 하였고 만들어져 있는 프로시저를 분석하는 작업을 진행하였다.   
  DB에 분석을 마치고 특정 상황조건에 따른 데이터 입,출력을 하는 프로시저 작성을 하고 팀장님의 피드백을 받아 재작성하여 최종적으로 프로시저를 완성하였다.  
  
  - 날짜별 등하교율 조회 프로그램 : 팀장님께서 과제로 내주신 조건에 대한 데이터를 검색하는 SQL문을 연습하는 시간을 가졌고, 최종적으로 여러개의 테이블을 종합적으로 합쳐서 데이터를 검색(해당 날짜에 대한 등,하교율 검색)하는 SQL문을 작성하는 작업을 했으며, 이클립스와 MSSQL을 연동하여 위에서 한 작업을 이클립스 스윙을 이용하여GUI 환경을 구축하여 날짜를 입력하면 결과가 나오는 프로젝트를 만들었다.  
  
  - 암호화, 복호화 프로그램 : KISA에서 제공하는 ARIA 알고리즘을 이용하여 사용자가 핸드폰번호나 주민등록번호 계좌번호등의 개인정보 보호가 필요한 것을 입력하면 암호화하여 저장하고 그 내용을 조회할땐 복호화 시켜 정보를 조회할 수 있는 프로젝트를 진행했다.  

  - 푸시 메세지 전송 프로그램 : 다수의 사람을 대상으로 푸시 메세지를 보내는 프로젝트를 진행하였다. 개인이나 다수의 사람의 핸드폰 번호를 입력하면 해당 번호를 DB를 조회하여 그 사람의 토큰값을 가져와서 List에 저장하여 일괄적으로 한번에 푸시 메세지를 전송하는 방식을 프로젝트를 만들었다.  
  
  - 패킷 추출 프로그램 : TCP 연결을 통해서 연속적으로 임의의 데이터가 계속 들어올때, 버퍼에 데이터를 저장한 뒤 패킷을 추출하는 프로젝트를 구현했다. 패킷은 STX, CMD, LEN, RSV, PID, SDU, ETX 의 데이터로 구성되는데 패킷의 맨 앞(STX - F0F0)과 맨 뒤(ETX - FEFE)는 고정값으로 정해져있기에 그 부분을 찾아서 패킷을 추출하면 된다. 구현 과정은 첫번째로 버퍼에 STX의 데이터인 F0F0 을 찾고 STX를 기준으로 앞부분에 데이터는 삭제해준다. 두번째로 STX에서 3byte 떨어진 LEN의 값을 가져와 RSV와 PID, SDU의 길이를 구한다. 세번째로 STX+CMD+LEN 을 해줌으로써 ETX의 데이터를 확인해서 FEFE 가 아니면 쓰레기 데이터이고 FEFE가 맞다면 하나의 패킷인 것이다. 마지막으로 패킷을 추출하여 List에 저장하고 데이터를 화면에 보여주고 나머지 버퍼에 남은 데이터를 화면에 보여준다.  
추출한 패킷을 PacketClass라는 클래스에 STX, CMD, LEN, RSV, PID, SDU, ETX 의 필드를 만들어 데이터를 분리해서 넣어주고 CMD 데이터를 조회하여 값에 대응하는 SDU의 데이터 구조에서 APNO를 꺼내와 SDU에 넣어준다. 그리고 CMD에 0x80 을 더해주는 작업을 해준다. 위의 작업을 거쳐 패킷을 재구성하여 수신받은 곳에 다시 송신해준다.  
SDU의 데이터는 CMD의 값에 따라 TAGDATA, START, STOP, LINK, ERROR, LEVEL 의 종류로 나뉜다. SDU의 데이터가 제대로 된 데이터가 아닐 수 있기에 SDU의 데이터를 세분화하여 데이터의 유효성 검사를 해야한다. CMD의 데이터가 0x80일때 SDU의 데이터 종류는 TAGDATA 의 경우에 유효성 검사하는 프로세스를 추가하는 작업을 하였다. TAGDATA의 데이터는TAGNO|APNO|TXTTYPE|ORGID|ATTR|SENSE|BAT 으로 구성되어 있어 각각의 데이터마다 클래스화 하여 데이터를 검사하는 방식으로 코드를 짰다. 유효성을 검사하는 기능을 추가 후 단순히 하나씩 데이터를 수신하여 다시 클라이언트에게 보내는 작업이 완료되었다. 이제는 하나씩 보내지 않고 대량의 데이터를 연속적으로 보낼때도 이상이 없는지 테스트를 진행했는데 예외가 발생되었다. 클라이언트가 데이터를 보내고 연결을 끊어버린 경우에 데이터를 가공후 클라이언트에게 다시 보낼때 클라이언트의 연결이 끊겼기에 보낼수가 없는 예외가 발생해버렸다. 이 경우에 데이터를 보내지않고 단순히 소켓을 종료시키는 예외처리를 하였다. 다시 테스트를 거친 결과 예외없이 잘 진행되어 TCP 프로젝트를 완성하였다.  
TCP통신을 활용한 패킷 데이터를 다루는 프로젝트는 해본 경험이 없었는데 이번 인턴 과정에서 만들어봄으로써 내 자신의 개발 능력을 향상시킬 수 있었다.
